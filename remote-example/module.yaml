version: "1.0"
module:
  meta:
    type: remote
  spec:
    functions:
    - function:
        meta:
          kind: http
          type: shopping/supply
        spec:
          endpoint: http://app:8000/statefun
          states:
          - supply
          maxNumBatchRequests: 100
          timeout: 1min
    - function:
        meta:
          kind: http
          type: shopping/basket
        spec:
          endpoint: http://app:8000/statefun
          states:
          - basket
          maxNumBatchRequests: 100
          timeout: 1min
    ingresses:
    - ingress:
        meta:
          type: statefun.kafka.io/routable-protobuf-ingress
          id: shopping/restock
        spec:
          address: kafka-broker:19092
          consumerGroupId: remote-example
          topics:
          - topic: restock
            typeUrl: com.googleapis/shopping.protocols.Supply.Restock
            targets:
            - shopping/supply
    - ingress:
        meta:
          type: statefun.kafka.io/routable-protobuf-ingress
          id: shopping/add-to-basket
        spec:
          address: kafka-broker:19092
          consumerGroupId: remote-example
          topics:
          - topic: add-to-basket
            typeUrl: com.googleapis/shopping.protocols.Basket.Add
            targets:
            - shopping/basket
    egresses:
    - egress:
        meta:
          type: statefun.kafka.io/generic-egress
          id: shopping/supply-changed
        spec:
          address: kafka-broker:19092
          deliverySemantic:
            type: exactly-once
            transactionTimeoutMillis: 100000
